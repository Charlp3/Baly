<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Suivi de mon chien ‚Äì v1.9e</title>

<style>
  body { font-family: Arial, sans-serif; margin:0; background:#D0E4F7; color:#1C2A40; }
  header { background:#2C5E99; color:#fff; text-align:center; padding:15px; }

  nav { display:flex; background:#1C3B68; flex-wrap:wrap; }
  nav button{
    flex:1 1 33%;
    padding:12px;
    background:#1C3B68;
    color:#fff;
    border:none;
    font-size:1rem;
  }
  nav button.active{
    background:#D0E4F7;
    color:#1C3B68;
    font-weight:bold;
  }

  section { display:none; padding:20px; }
  section.active { display:block; }

  label { display:block; margin-top:10px; font-weight:bold; }
  input, textarea{
    width:100%;
    padding:8px;
    margin-top:4px;
    border-radius:4px;
    border:1px solid #587EA3;
    background:#F0F8FF;
    font-size:1rem;
    box-sizing:border-box;
  }

  #fiche label { font-size:1.1rem; }
  #fiche input, #fiche textarea { font-size:1.15rem; padding:10px; }

  button.action{
    margin-top:12px;
    padding:10px 15px;
    background:#2C5E99;
    color:#fff;
    border:none;
    border-radius:5px;
    font-size:1rem;
  }

  button.suppr{
    background:#C0392B;
    color:#fff;
    border:none;
    border-radius:4px;
    padding:4px 8px;
    font-size:0.8rem;
    margin-top:6px;
  }

  hr { margin:18px 0; }
  a { color:#1C3B68; word-break:break-all; }

  .ligne { margin-bottom:10px; }
  .petit { font-size:0.9rem; opacity:0.85; }
</style>
</head>

<body>

<header>
  Suivi de mon chien üê∂<br>
  <small>¬© Pierre Charlier 2025 ‚Äî Version 1.9e</small>
</header>

<nav>
  <button class="active" onclick="showTab('fiche', this)">Fiche</button>
  <button onclick="showTab('sante', this)">Sant√©</button>
  <button onclick="showTab('liens', this)">Liens Web</button>
</nav>

<main>

<!-- ================= FICHE ================= -->
<section id="fiche" class="active">
  <label>Puce</label><input id="puce">
  <label>Passeport</label><input id="passeport">

  <label>Date de naissance</label>
  <input type="date" id="naissance" onchange="updateAge(); saveData(false)">
  <div><strong>√Çge :</strong> <span id="age">-</span></div>

  <label>Poids (kg)</label><input type="number" id="poids">
  <label>V√©t√©rinaire</label><input id="veto">
  <label>T√©l√©phone</label><input id="tel">
  <label>Clinique</label><input id="clinique">

  <label>Nourriture</label><textarea id="nourriture"></textarea>
  <label>Accessoires</label><textarea id="accessoires"></textarea>
  <label>Autres</label><textarea id="autres"></textarea>

  <hr>

  <label>üìÑ Document PDF (ex. passeport)</label>
  <div class="petit" id="pdfInfo">Aucun PDF s√©lectionn√©</div>

  <input type="file" id="pdfInput" accept="application/pdf" hidden>
  <button class="action" onclick="choisirPDF()">‚ûï Choisir / remplacer le PDF</button>
  <button class="action" onclick="ouvrirPDF()">üìÇ Ouvrir le PDF (via Fichiers)</button>

  <hr>

  <button class="action" onclick="saveData(true)">üíæ Sauvegarder</button>
  <button class="action" onclick="exportData()">üì§ Exporter JSON</button>

  <input type="file" id="importInput" accept="application/json" hidden onchange="importData(event)">
  <button class="action" onclick="document.getElementById('importInput').click()">üì• Importer</button>
</section>

<!-- ================= SANTE ================= -->
<section id="sante">
  <h3>Maladies</h3>
  <div id="listeMaladies"></div>
  <button class="action" onclick="ajouterMaladie()">+ Ajouter</button>
  <hr>

  <h3>Accidents</h3>
  <div id="listeAccidents"></div>
  <button class="action" onclick="ajouterAccident()">+ Ajouter</button>
  <hr>

  <h3>Traitements</h3>
  <div id="listeTraitements"></div>
  <button class="action" onclick="ajouterTraitement()">+ Ajouter</button>
</section>

<!-- ================= LIENS ================= -->
<section id="liens">
  <h3>Liens Web</h3>
  <input id="nomLien" placeholder="Nom">
  <input id="urlLien" placeholder="URL (https://...)">
  <button class="action" onclick="ajouterLien()">+ Ajouter le lien</button>
  <hr>
  <div id="listeLiens"></div>
</section>

</main>

<script>
const donn√©es = {
  fiche:{},
  maladies:[],
  accidents:[],
  traitements:[],
  liens:[],
  pdfNom:null
};

/* ---------- Navigation ---------- */
function showTab(id, btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(btn) btn.classList.add("active");
}

/* ---------- √Çge ---------- */
function updateAge(){
  if(!naissance.value){ age.textContent="-"; return; }
  const b=new Date(naissance.value), n=new Date();
  let a=n.getFullYear()-b.getFullYear();
  if(n.getMonth()<b.getMonth() || (n.getMonth()==b.getMonth() && n.getDate()<b.getDate())) a--;
  age.textContent = a + " an" + (a>1?"s":"");
}

/* ---------- PDF ---------- */
function choisirPDF(){
  document.getElementById("pdfInput").click();
}

pdfInput.onchange = ()=>{
  const f = pdfInput.files[0];
  if(!f) return;
  donn√©es.pdfNom = f.name;
  saveData(false);
  afficherPDFInfo();
  alert("PDF s√©lectionn√© :\n" + f.name);
  pdfInput.value="";
};

function ouvrirPDF(){
  alert(
    donn√©es.pdfNom
      ? "S√©lectionne le fichier ¬´ " + donn√©es.pdfNom + " ¬ª dans Fichiers."
      : "Aucun PDF m√©moris√©."
  );
}

/* ---------- Sauvegarde ---------- */
function saveData(showAlert=true){
  donn√©es.fiche={
    puce:puce.value,passeport:passeport.value,naissance:naissance.value,
    poids:poids.value,veto:veto.value,tel:tel.value,clinique:clinique.value,
    nourriture:nourriture.value,accessoires:accessoires.value,autres:autres.value
  };
  localStorage.setItem("chienData",JSON.stringify(donn√©es));
  if(showAlert) alert("‚úî Donn√©es sauvegard√©es");
}

function exportData(){
  const blob=new Blob([JSON.stringify(donn√©es,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="chien_sauvegarde.json";
  a.click();
  URL.revokeObjectURL(a.href);
}

function importData(e){
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    try{
      Object.assign(donn√©es, JSON.parse(r.result));
      localStorage.setItem("chienData",JSON.stringify(donn√©es));
      alert("‚úî Importation r√©ussie");
      location.reload();
    }catch{ alert("‚ùå Fichier invalide"); }
  };
  r.readAsText(f);
}

/* ---------- Liens ---------- */
function ajouterLien(){
  if(!urlLien.value) return;
  donn√©es.liens.push({nom:nomLien.value||urlLien.value, url:urlLien.value});
  nomLien.value=""; urlLien.value="";
  afficherLiens(); saveData(false);
}
function supprimerLien(i){
  donn√©es.liens.splice(i,1);
  afficherLiens(); saveData(false);
}
function afficherLiens(){
  listeLiens.innerHTML="";
  donn√©es.liens.forEach((l,i)=>{
    listeLiens.innerHTML+=`
      <div class="ligne">
        <strong>${l.nom}</strong><br>
        <a href="${l.url}" target="_blank">${l.url}</a><br>
        <button class="suppr" onclick="supprimerLien(${i})">Supprimer</button>
        <hr>
      </div>`;
  });
}

/* ---------- Sant√© ---------- */
function ajouterMaladie(){
  donn√©es.maladies.push({nom:"",date:"",remarque:""});
  afficherMaladies(); saveData(false);
}
function supprimerMaladie(i){
  donn√©es.maladies.splice(i,1);
  afficherMaladies(); saveData(false);
}
function afficherMaladies(){
  listeMaladies.innerHTML="";
  donn√©es.maladies.forEach((m,i)=>{
    listeMaladies.innerHTML+=`
      <input placeholder="Maladie" value="${m.nom}">
      <input type="date" value="${m.date}">
      <textarea>${m.remarque}</textarea>
      <button class="suppr" onclick="supprimerMaladie(${i})">Supprimer</button>
      <hr>`;
  });
}

function ajouterAccident(){
  donn√©es.accidents.push({type:"",date:"",suite:""});
  afficherAccidents(); saveData(false);
}
function supprimerAccident(i){
  donn√©es.accidents.splice(i,1);
  afficherAccidents(); saveData(false);
}
function afficherAccidents(){
  listeAccidents.innerHTML="";
  donn√©es.accidents.forEach((a,i)=>{
    listeAccidents.innerHTML+=`
      <input placeholder="Accident" value="${a.type}">
      <input type="date" value="${a.date}">
      <textarea>${a.suite}</textarea>
      <button class="suppr" onclick="supprimerAccident(${i})">Supprimer</button>
      <hr>`;
  });
}

function ajouterTraitement(){
  donn√©es.traitements.push({nom:"",debut:"",fin:"",posologie:""});
  afficherTraitements(); saveData(false);
}
function supprimerTraitement(i){
  donn√©es.traitements.splice(i,1);
  afficherTraitements(); saveData(false);
}
function afficherTraitements(){
  listeTraitements.innerHTML="";
  donn√©es.traitements.forEach((t,i)=>{
    listeTraitements.innerHTML+=`
      <input placeholder="Traitement" value="${t.nom}">
      <input type="date" value="${t.debut}">
      <input type="date" value="${t.fin}">
      <textarea>${t.posologie}</textarea>
      <button class="suppr" onclick="supprimerTraitement(${i})">Supprimer</button>
      <hr>`;
  });
}

/* ---------- Init ---------- */
function afficherPDFInfo(){
  pdfInfo.textContent = donn√©es.pdfNom
    ? "PDF m√©moris√© : " + donn√©es.pdfNom
    : "Aucun PDF s√©lectionn√©";
}

window.onload=()=>{
  const s=JSON.parse(localStorage.getItem("chienData")||"{}");
  if(!s.fiche) return;
  Object.assign(donn√©es,s);
  Object.entries(donn√©es.fiche).forEach(([k,v])=>{
    const el=document.getElementById(k);
    if(el) el.value=v||"";
  });
  updateAge();
  afficherPDFInfo();
  afficherLiens();
  afficherMaladies();
  afficherAccidents();
  afficherTraitements();
};
</script>

</body>
</html>