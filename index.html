<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suivi Chien ‚Äì v1.8 (Liens)</title>
  <style>
    body { font-family: Arial; margin: 0; background: #D0E4F7; color: #1C2A40; }
    header { background: #2C5E99; color: #fff; text-align: center; padding: 15px; position: relative; }
    nav { display: flex; background: #1C3B68; flex-wrap: wrap; }
    nav button {
      flex: 1 1 25%; padding: 12px; background: #1C3B68; color: white;
      border: none; font-size: 1rem; cursor: pointer;
    }
    nav button.active {
      background: #D0E4F7; color: #1C3B68; font-weight: bold;
    }
    section { display: none; padding: 20px; }
    section.active { display: block; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea {
      width: 100%; padding: 8px; margin-top: 4px;
      border-radius: 4px; border: 1px solid #587EA3;
      background-color: #F0F8FF; font-size: 1rem;
    }
    button.action {
      margin-top: 15px;
      background-color: #2C5E99;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    button.action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .header-actions {
      position: absolute;
      right: 10px;
      top: 10px;
      display: flex;
      gap: 6px;
    }
  </style>
</head>

<body>

<header>
  Suivi de mon chien üêæ<br />
  <small>¬© Pierre Charlier 2025 ‚Äî Version 1.8</small>

  <div class="header-actions">
    <button id="lockBtn" class="action" onclick="toggleLock()">üîí Verrouill√©</button>
    <button id="restoreBtn" class="action" onclick="document.getElementById('importJson').click()">‚ôªÔ∏è Restaurer</button>
    <input type="file" id="importJson" accept=".json" hidden>
  </div>
</header>

<nav>
  <button onclick="showTab('fiche')" class="active">Fiche</button>
  <button onclick="showTab('medicaments')">M√©dicaments</button>
  <button onclick="showTab('vaccins')">Vaccins</button>
  <button onclick="showTab('notices')">Notices</button>
  <button onclick="showTab('pdf')">Passeport PDF</button>
  <button onclick="showTab('liens')">Liens Web</button>
</nav>

<main>

<section id="fiche" class="active">
  <label>Num√©ro de puce</label><input id="puce">
  <label>Num√©ro de passeport</label><input id="passeport">
  <label>Date de naissance</label><input type="date" id="naissance" onchange="updateAge()">
  <div><strong>√Çge :</strong> <span id="age">-</span></div>
  <label>Poids (kg)</label><input type="number" id="poids">
  <label>V√©t√©rinaire</label><input id="veto">
  <label>T√©l√©phone</label><input id="tel">
  <label>Clinique</label><input id="clinique">
  <label>Nourriture</label><textarea id="nourriture"></textarea>
  <label>Accessoires</label><textarea id="accessoires"></textarea>
  <label>Autres</label><textarea id="autres"></textarea>
  <button id="saveBtn" class="action" onclick="saveData()">üíæ Sauvegarder</button>
</section>

<section id="medicaments">
  <h3>M√©dicaments</h3>
  <div id="listeMeds"></div>
  <button id="addMedBtn" class="action" onclick="ajouterMedicament()">+ Ajouter M√©dicament</button>
</section>

<section id="vaccins">
  <h3>Vaccins & Antiparasitaires</h3>
  <div id="listeVaccins"></div>
  <button id="addVacBtn" class="action" onclick="ajouterVaccin()">+ Ajouter Vaccin</button>
</section>

<section id="notices">
  <h3>Notices</h3>
  <ul id="listeNotices"></ul>
</section>

<section id="pdf">
  <h3>Pages du Passeport PDF</h3>
  <input type="file" id="pdfInput" accept="application/pdf">
  <button id="addPdfBtn" class="action" onclick="ajouterPDF()">+ Ajouter PDF</button>
  <ul id="listePDF"></ul>
</section>

<section id="liens">
  <h3>Liens Internet</h3>
  <div id="listeLiens"></div>
  <button id="addLinkBtn" class="action" onclick="ajouterLien()">+ Ajouter lien</button>
</section>

</main>

<script>
let appLocked = true;
const donn√©es = { fiche:{}, meds:[], vaccins:[], pdfs:[], liens:[] };

function toggleLock(){
  appLocked = !appLocked;
  document.getElementById("lockBtn").textContent = appLocked ? "üîí Verrouill√©" : "üîì D√©verrouill√©";
  applyLock();
}

function applyLock(){
  document.querySelectorAll("input, textarea").forEach(e => e.disabled = appLocked);
  saveBtn.disabled = appLocked;
  addMedBtn.disabled = appLocked;
  addVacBtn.disabled = appLocked;
  addPdfBtn.disabled = appLocked;
  addLinkBtn.disabled = appLocked;
}

function showTab(id){
  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.querySelector(`nav button[onclick="showTab('${id}')"]`).classList.add("active");
  document.getElementById(id).classList.add("active");
}

function updateAge(){
  const n = naissance.value;
  if(!n) return age.textContent = "-";
  const b = new Date(n), d = new Date();
  let a = d.getFullYear() - b.getFullYear();
  if(d.getMonth() < b.getMonth() || (d.getMonth()==b.getMonth() && d.getDate()<b.getDate())) a--;
  age.textContent = a + " an" + (a>1?"s":"");
}

function saveData(){
  if(appLocked) return;
  donn√©es.fiche = {
    puce:puce.value, passeport:passeport.value, naissance:naissance.value,
    poids:poids.value, veto:veto.value, tel:tel.value,
    clinique:clinique.value, nourriture:nourriture.value,
    accessoires:accessoires.value, autres:autres.value
  };
  localStorage.setItem("chienData", JSON.stringify(donn√©es));
  alert("‚úî Donn√©es sauvegard√©es");
  majNotices();
}

document.getElementById("importJson").addEventListener("change", e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{
    try{
      const obj = JSON.parse(r.result);
      localStorage.setItem("chienData", JSON.stringify(obj));
      alert("‚úî Restauration r√©ussie");
      location.reload();
    }catch{
      alert("‚ùå Fichier JSON invalide");
    }
  };
  r.readAsText(f);
});

window.onload = ()=>{
  const s = JSON.parse(localStorage.getItem("chienData")||"{}");
  Object.assign(donn√©es, s);
  if(donn√©es.fiche){
    puce.value=donn√©es.fiche.puce||""; passeport.value=donn√©es.fiche.passeport||"";
    naissance.value=donn√©es.fiche.naissance||""; poids.value=donn√©es.fiche.poids||"";
    veto.value=donn√©es.fiche.veto||""; tel.value=donn√©es.fiche.tel||"";
    clinique.value=donn√©es.fiche.clinique||""; nourriture.value=donn√©es.fiche.nourriture||"";
    accessoires.value=donn√©es.fiche.accessoires||""; autres.value=donn√©es.fiche.autres||"";
  }
  updateAge();
  applyLock();
};
</script>

</body>
</html>