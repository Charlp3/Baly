<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fiche Chien - Pierre Charlier 2025</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #D0E4F7;
      color: #1C2A40;
      padding: 20px;
    }
    h1 {
      background-color: #2C5E99;
      color: white;
      padding: 12px;
      text-align: center;
      border-radius: 8px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
      font-size: 1.1rem;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 5px;
      border: 1px solid #587EA3;
      background-color: #F0F8FF;
      font-size: 1.1rem;
    }
    button {
      background-color: #2C5E99;
      color: white;
      padding: 8px 12px;
      margin: 8px 6px 0 0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.05rem;
    }
    button:hover {
      background-color: #20446E;
    }
    .entry-group {
      border: 1px solid #bbb;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      background-color: #EAF2FB;
    }
    .delete-btn {
      background-color: #c33;
      color: white;
      font-size: 0.95rem;
      margin-top: 6px;
      padding: 6px 10px;
      border-radius: 4px;
    }
    .delete-btn:hover {
      background-color: #a00;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background-color: #f9fbff;
      font-size: 1.05rem;
    }
    th, td {
      padding: 10px;
      border: 1px solid #587EA3;
      text-align: left;
    }
    th {
      background-color: #2C5E99;
      color: white;
    }
    footer {
      margin-top: 30px;
      text-align: center;
      font-size: 0.9rem;
      color: #1C2A40;
      border-top: 1px solid #587EA3;
      padding-top: 10px;
    }
  </style>
</head>
<body>
<h1>Contr√¥le de mon chien üêæ</h1>
<form id="dogForm">
  <label>N¬∫ Puce</label>
  <input type="text" id="chipId"/>
  <label>N¬∫ Passeport</label>
  <input type="text" id="passportId"/>
  <label>Date de naissance</label>
  <input type="date" id="birthDate"/>
  <label>Poids (kg)</label>
  <input type="number" id="weight" step="0.1"/>

  <label>Vaccinations</label>
  <div id="vaccinationList"></div>
  <button type="button" onclick="addVaccination()">+ Ajouter vaccination</button>

  <label>D√©parasitage</label>
  <div id="deparasitageList"></div>
  <button type="button" onclick="addDeparasitage()">+ Ajouter d√©parasitage</button>

  <label>Maladies</label>
  <div id="maladiesList"></div>
  <button type="button" onclick="addMaladie()">+ Ajouter maladie</button>

  <label>Laboratoire</label>
  <div id="laboList"></div>
  <button type="button" onclick="addLabo()">+ Ajouter labo</button>

  <label>Radiographies (Rx)</label>
  <div id="rxList"></div>
  <button type="button" onclick="addRx()">+ Ajouter Rx</button>

  <label>V√©to / Confr√®res</label>
  <input type="text" id="veto"/>
  <label>T√©l√©phone</label>
  <input type="tel" id="tel"/>
  <label>Clinique / Cabinet</label>
  <input type="text" id="clinic"/>
  <label>Nourriture</label>
  <textarea id="nourriture"></textarea>
  <label>Accessoires</label>
  <textarea id="accessoires"></textarea>
  <label>Autres</label>
  <textarea id="autres"></textarea>

  <div>
    <button type="button" onclick="exportJSON()">üíæ Exporter JSON</button>
    <button type="button" onclick="document.getElementById('importFile').click()">üìÅ Importer JSON</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(event)"/>
    <button type="button" onclick="clearData()">üóë Effacer les donn√©es</button>
  </div>
</form>

<table id="dataTable">
  <thead><tr><th>Champ</th><th>Valeur</th></tr></thead>
  <tbody></tbody>
</table>

<footer>¬© Pierre Charlier 2025 ‚Äî Version 1.6</footer>

<script>
const fields = [
  { id: "chipId", label: "N¬∫ Puce" },
  { id: "passportId", label: "N¬∫ Passeport" },
  { id: "birthDate", label: "Date de naissance" },
  { id: "weight", label: "Poids (kg)" },
  { id: "veto", label: "V√©to / Confr√®res" },
  { id: "tel", label: "T√©l√©phone" },
  { id: "clinic", label: "Clinique / Cabinet" },
  { id: "nourriture", label: "Nourriture" },
  { id: "accessoires", label: "Accessoires" },
  { id: "autres", label: "Autres" }
];

let vaccinations = [], deparasitage = [], maladies = [], laboList = [], rxList = [];

window.onload = () => {
  const saved = localStorage.getItem("dogData");
  if (saved) {
    const data = JSON.parse(saved);
    fields.forEach(f => {
      if (data[f.id]) document.getElementById(f.id).value = data[f.id];
    });
    vaccinations = data.vaccinations || [];
    deparasitage = data.deparasitage || [];
    maladies = data.maladies || [];
    laboList = data.laboList || [];
    rxList = data.rxList || [];
    renderEntries();
    updateTable();
  }
};

fields.forEach(f => {
  document.getElementById(f.id).addEventListener("input", autoSave);
});

function formatDate(d) {
  if (!d) return "";
  const dt = new Date(d);
  return ('0'+dt.getDate()).slice(-2) + "/" + ('0'+(dt.getMonth()+1)).slice(-2) + "/" + dt.getFullYear();
}

function renderList(list, elementId, type) {
  const div = document.getElementById(elementId);
  div.innerHTML = "";
  list.forEach((item, i) => {
    div.innerHTML += `
      <div class="entry-group">
        <input type="date" value="${item.date}" onchange="${type}[${i}].date=this.value; autoSave()"/>
        <input type="text" placeholder="Description" value="${item.nom}" onchange="${type}[${i}].nom=this.value; autoSave()"/>
        <button class="delete-btn" onclick="${type}.splice(${i},1); renderEntries(); autoSave()">‚ùå Supprimer</button>
      </div>`;
  });
}

function renderEntries() {
  renderList(vaccinations, "vaccinationList", "vaccinations");
  renderList(deparasitage, "deparasitageList", "deparasitage");
  renderList(maladies, "maladiesList", "maladies");
  renderList(laboList, "laboList", "laboList");
  renderList(rxList, "rxList", "rxList");
  updateTable();
}

function autoSave() {
  const data = {};
  fields.forEach(f => data[f.id] = document.getElementById(f.id).value);
  data.vaccinations = vaccinations;
  data.deparasitage = deparasitage;
  data.maladies = maladies;
  data.laboList = laboList;
  data.rxList = rxList;
  localStorage.setItem("dogData", JSON.stringify(data));
  updateTable();
}

function updateTable() {
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";
  const addRow = (label, value) => {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${label}</td><td>${value}</td>`;
    tbody.appendChild(row);
  };
  fields.forEach(f => {
    const val = document.getElementById(f.id).value;
    addRow(f.label, f.id.includes("Date") ? formatDate(val) : val);
  });
  vaccinations.forEach((v, i) => addRow(`Vaccination ${i+1}`, `${formatDate(v.date)} ‚Äî ${v.nom}`));
  deparasitage.forEach((d, i) => addRow(`D√©parasitage ${i+1}`, `${formatDate(d.date)} ‚Äî ${d.nom}`));
  maladies.forEach((m, i) => addRow(`Maladie ${i+1}`, `${formatDate(m.date)} ‚Äî ${m.nom}`));
  laboList.forEach((l, i) => addRow(`Labo ${i+1}`, `${formatDate(l.date)} ‚Äî ${l.nom}`));
  rxList.forEach((r, i) => addRow(`Rx ${i+1}`, `${formatDate(r.date)} ‚Äî ${r.nom}`));
}

function clearData() {
  if (confirm("Supprimer toutes les donn√©es ?")) {
    localStorage.removeItem("dogData");
    location.reload();
  }
}

function exportJSON() {
  const data = {};
  fields.forEach(f => data[f.id] = document.getElementById(f.id).value);
  data.vaccinations = vaccinations;
  data.deparasitage = deparasitage;
  data.maladies = maladies;
  data.laboList = laboList;
  data.rxList = rxList;
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = "chien_sauvegarde.json";
  link.click();
  URL.revokeObjectURL(url);
}

function importJSON(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const data = JSON.parse(e.target.result);
      fields.forEach(f => {
        if (data[f.id] !== undefined) document.getElementById(f.id).value = data[f.id];
      });
      vaccinations = data.vaccinations || [];
      deparasitage = data.deparasitage || [];
      maladies = data.maladies || [];
      laboList = data.laboList || [];
      rxList = data.rxList || [];
      renderEntries();
      autoSave();
      alert("‚úî Import r√©ussi avec succ√®s !");
    } catch {
      alert("Erreur lors de l'import JSON.");
    }
  };
  reader.readAsText(file);
}

function addVaccination() { vaccinations.push({ date: "", nom: "" }); renderEntries(); autoSave(); }
function addDeparasitage() { deparasitage.push({ date: "", nom: "" }); renderEntries(); autoSave(); }
function addMaladie() { maladies.push({ date: "", nom: "" }); renderEntries(); autoSave(); }
function addLabo() { laboList.push({ date: "", nom: "" }); renderEntries(); autoSave(); }
function addRx() { rxList.push({ date: "", nom: "" }); renderEntries(); autoSave(); }
</script>
</body>
</html>
